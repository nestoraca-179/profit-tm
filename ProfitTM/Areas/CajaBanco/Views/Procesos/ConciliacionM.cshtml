@{
    ViewBag.Title = "ConciliacionM";
}
<style>
    table#table-transfers {
        border-top: solid 10px transparent !important;
    }
    table thead {
        background: #0277bd;
        color: #FFF;
    }
    table td {
        vertical-align: middle;
        border: 0 !important;
    }
    table tr {
        border: 0 !important;
    }
    table thead tr th {
        padding: 15px 5px !important;
    }
    table tbody tr td {
        font-size: 14px;
        user-select: none;
    }
    select[name="table-transfers_length"] {
        background: #FFF !important;
        border: solid 1px #ced4da !important;
        box-shadow: none;
    }
    #table-transfers_filter input {
        background: #FFF;
        border: solid 1px #ced4da;
        border-radius: 5px;
    }
    #table-transfers_paginate {
        user-select: none;
    }
    #table-transfers_paginate > a:not(.disabled) {
        background: #0d6efd;
        color: #FAFAFA !important;
        border-radius: 5px;
    }
    #table-transfers_paginate > a:not(.disabled):hover {
        background: #0b5ed7;
    }
    #table-transfers_paginate > span a.paginate_button:not(.disabled).current, #table-transfers_paginate > span a.paginate_button:not(.disabled):hover {
        background: none;
        border: solid 2px #0d6efd;
        border-radius: 5px;
        color: #333 !important;
    }
    .transf-buttons {

    }
    .transf-buttons button {
        font-size: 13px;
        padding: 5px 10px;
    }
</style>
<script src="~/Scripts/angular-min.js"></script>
<link href="https://cdn.datatables.net/v/dt/dt-1.13.4/datatables.min.css" rel="stylesheet" />
<script src="https://cdn.datatables.net/v/dt/dt-1.13.4/datatables.min.js"></script>
<div class="container-fluid my-3" ng-app="ConcM" ng-controller="controller">
    <div class="row m-3">
        <div class="col"></div>
        <div class="col">
            <h2 class="text-center">Conciliación Manual</h2>
        </div>
        <div class="col"></div>
    </div>
    <hr />
    <div>
        <table class="table table-sm table-striped table-hover" id="table-transfers">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Usuario</th>
                    <th>Fecha</th>
                    <th>Monto</th>
                    <th>Cuenta</th>
                    <th>Nro. Transf.</th>
                    <th>Descripcion</th>
                    <th>Nro. Cobro</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                <tr ng-repeat="t in transfers | orderBy:'-Date'">
                    <td>{{ t.ID }}</td>
                    <td>{{ t.UserID }}</td>
                    <td>{{ formatDate(t.Date) }}</td>
                    <td>{{ setSeparator(t.Amount.toFixed(2)) }}</td>
                    <td>{{ t.AccountID }}</td>
                    <td>{{ t.DocNum }}</td>
                    <td>{{ t.Comment.toUpperCase() }}</td>
                    <td style="user-select: text;">{{ t.Collect }}</td>
                    <td class="transf-buttons" style="padding-left: 0;">
                        <button type="button" class="btn btn-danger" ng-click="cancelTransf(t)">
                            <i class="fas fa-times"></i> Anular
                        </button>
                        <button type="button" class="btn btn-success mx-2" ng-click="concilTransf(t)">
                            <i class="fas fa-check"></i> Conciliar
                        </button>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>
<script>
    var app = angular.module("ConcM", []);
    var user = '@ViewBag.username';
    var transfers = @Html.Raw(Json.Encode(ViewBag.transfers));
    var options = { day: '2-digit', month: '2-digit', year: 'numeric', hour: '2-digit', minute: '2-digit' };

    for (var t of transfers) {
        t.Date = new Date(parseInt(t.Date.substr(6)));

        try {
            t.Collect = t.Comment.split("(")[1].replace(/\D/g, "");
        } catch (e) {
            t.Collect = "N/A";
        }
    }

    $(document).ready(function () {
        $('#table-transfers').DataTable({
            "language": {
                "lengthMenu": "Mostrar _MENU_ registros por página",
                "info": "Página _PAGE_ de _PAGES_ - Mostrando _END_ de _TOTAL_ registros",
                "infoEmpty": "Mostrando _END_ de _TOTAL_ registros",
                "infoFiltered": "(filtrado de un total de _MAX_ registros)",
                "processing": "Procesando...",
                "search": "Buscar:   ",
                "zeroRecords": "No se encontraron resultados",
                "paginate": {
                    "first": "Primero",
                    "last": "Ultimo",
                    "next": "Siguiente",
                    "previous": "Anterior"
                },
            },
            "lengthMenu": [10, 25, 50, 75, 100],
        });
    });

    app.controller("controller", function ($scope, $http) {

        $scope.transfers = transfers;

        $scope.setSeparator = (value) => setSeparator(value);

        $scope.formatDate = (date) => date != null ? new Date(date).toLocaleString("es-ES", options).replace(",", "") : "";

        $scope.cancelTransf = function (t) {
            alert(t.Collect);
        }

    });

    function setSeparator(value) {
        return new Intl.NumberFormat('en-EN', { minimumFractionDigits: 2 }).format(value);
    }

</script>