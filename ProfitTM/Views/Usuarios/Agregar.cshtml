@{
    ViewData["Title"] = "Agregar Usuario";
    ViewData["home"] = Session["home"];
}
<style>
    
</style>
<header class="container-fluid">
    <div class="row">
        <div class="col-sm-2 header-left-side text-white">
            <i class="fas fa-bars icon-menu" id="icon-menu"></i>
            <a href="/Home/@ViewData["home"]">Profit Plus TM</a>
        </div>
        <div class="col-sm-10 header-right-side">
            <div class="user-active" role="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="fas fa-user icon-user"></i>
                <p class="mb-0">@ViewBag.user.Descrip</p>
            </div>
            <div style="width: 225px; text-align: center;" class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                <a style="text-align: center; text-decoration: none;" href="/Account/Logout">Cerrar Sesión</a>
            </div>
        </div>
    </div>
</header>
<div class="container-fluid p-0" ng-app="AddUser" ng-controller="controller">
    <div class="dash-container" id="dash-container">
        <div class="dash-left-side border-right p-0" id="menu-left">
            <ul class="list-menu dropright">
                @{
                    foreach (var item in ViewBag.modules)
                    {
                        string disReport = item.ReportURL == "#" ? "disabled" : "";

                        <li class="menu-item" onclick="print(this)">
                            <i class="@item.Icon"></i>
                            <p class="mb-0 ml-3">@item.Name</p>
                            <i class="fas fa-caret-up"></i>
                        </li>
                        <div class="my-dropdown">
                            @{
                                foreach (var elem in item.Options)
                                {
                                    <a class="dropdown-item" href="@elem.URL"><i class="@elem.Icon"></i> @elem.Name</a>
                                }
                            }
                            <a class="dropdown-item @disReport" href="@item.ReportURL"><i class="fas fa-file"></i>  Reportes</a>
                        </div>
                    }
                }
                <li class="menu-item">
                    <i class="fas fa-cog fa-spin"></i>
                    <p class="mb-0 ml-3">Configuración</p>
                </li>
            </ul>
        </div>
        <div class="dash-right-side">
            <div class="container-fluid">
                <h2 class="text-center mt-4">Agregar Usuario</h2>
                <form action="" method="post" class="mt-5" onsubmit="return false;">
                    <div class="row">
                        <div class="col-sm-6">
                            <div class="form-group row">
                                <label class="col-sm-4">Usuario</label>
                                <div class="col-sm-8">
                                    <input type="text" class="form-control" autocomplete="false" autofocus ng-model="user.Username" />
                                </div>
                            </div>
                            <div class="form-group row">
                                <label class="col-sm-4">Nombre</label>
                                <div class="col-sm-8">
                                    <input type="text" class="form-control" autocomplete="false" ng-model="user.Descrip" />
                                </div>
                            </div>
                            <div class="form-group row">
                                <label class="col-sm-4">Clave</label>
                                <div class="col-sm-8">
                                    <input type="password" class="form-control" autocomplete="false" ng-model="user.Password" />
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="form-group row">
                                <label class="col-sm-4">Cédula</label>
                                <div class="col-sm-8">
                                    <input type="text" class="form-control" autocomplete="false" ng-model="user.CI" />
                                </div>
                            </div>
                            <div class="form-group row">
                                <label class="col-sm-4">Email</label>
                                <div class="col-sm-8">
                                    <input type="email" class="form-control" autocomplete="false" autofocus ng-model="user.Email" />
                                </div>
                            </div>
                            <div class="form-group row">
                                <label class="col-sm-4">Teléfono</label>
                                <div class="col-sm-8">
                                    <input type="text" class="form-control" autocomplete="false" ng-model="user.Phone" />
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row mt-5">
                        <div class="col-sm-6">
                            <fieldset class="form-group">
                                <div class="row">
                                    <legend class="col-sm-4 col-form-label pt-0">Acceso a aplicativos</legend>
                                    <div class="col-sm-8">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" ng-model="user.IsAdm">
                                            <label class="form-check-label">Administrativo</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" ng-model="user.IsCon" ng-disabled="true">
                                            <label class="form-check-label">Contabilidad</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" ng-model="user.IsNom" ng-disabled="true">
                                            <label class="form-check-label">Nómina</label>
                                        </div>
                                    </div>
                                </div>
                            </fieldset>
                            <fieldset class="form-group">
                                <div class="row">
                                    <legend class="col-sm-4 col-form-label pt-0">Acceso a módulos</legend>
                                    <div class="col-sm-8">
                                        <p ng-if="!user.IsAdm && !user.IsCon && !user.IsNom">No has seleccionado ningún aplicativo</p>
                                        <div class="form-check" ng-repeat="mod in modules" ng-show="showMod(mod)">
                                            <h5 ng-if="modules[$index - 1].Product != modules[$index].Product" class="text-center font-weight-bold">{{ prods[mod.Product] }}</h5>
                                            <input class="form-check-input" type="checkbox" ng-click="checked($event.target.checked, mod)" ng-disabled="mod.Options.length == 0">
                                            <label class="form-check-label">{{ mod.Name }}</label>
                                        </div>
                                    </div>
                                </div>
                            </fieldset>
                        </div>
                        <div class="col-sm-6">
                            <fieldset class="form-group">
                                <div class="row">
                                    <legend class="col-sm-4 col-form-label pt-0">Acceso a opciones</legend>
                                    <div class="col-sm-8">
                                        <p ng-if="modsChecked.length == 0">No has seleccionado ningún módulo</p>
                                        <div ng-repeat="mod in modsChecked">
                                            <h5 class="text-center font-weight-bold">{{ mod.Name }}</h5>
                                            <div class="form-check" ng-repeat="opt in mod.Options">
                                                <input class="form-check-input" type="checkbox" @*ng-model="user.IsAdm"*@>
                                                <label class="form-check-label">{{ opt.Name }}</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </fieldset>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<script src="~/Content/angular-min.js"></script>
<script>
    var app = angular.module("AddUser", []);
    var modules = @Html.Raw(Json.Encode(ViewBag.allModules));
    var btn = document.getElementById("icon-menu");
    var menu = document.getElementById("menu-left");
    var node = null;

    console.log(modules);

    app.controller("controller", function ($scope, $http) {

        $scope.user = {};
        $scope.modules = modules;
        $scope.modsChecked = [];

        $scope.prods = {
            "ADM": "Administrativo",
            "CON": "Contabilidad",
            "NOM": "Nómina"
        };

        $scope.showMod = function (mod) {
            
            switch (mod.Product) {
                case "ADM":
                    return $scope.user.IsAdm;
                case "CON":
                    return $scope.user.IsCon;
                case "NOM":
                    return $scope.user.IsNom;
            }
        }

        $scope.checked = function (value, mod) {

            if (value) {
                $scope.modsChecked.push(mod);
            } else {
                var ind = $scope.modsChecked.indexOf(mod);
                $scope.modsChecked.splice(ind, 1);
            }
        }

    });

    btn.addEventListener("click", hide);

    function print(elem) {

        $(".my-dropdown").slideUp();

        if (node != null) {
            $(node).removeClass("selected");
            $(node).children("i.fa-caret-up").hide();
        }

        $(elem).addClass("selected");

        if (node != elem) {

            $(elem).next().slideDown();
            $(elem).next().css("display", "flex");
            $(elem).next().css("flex-direction", "column");
            $(elem).children("i.fa-caret-up").show();
            node = elem;

        } else {
            $(elem).removeClass("selected");
            $(elem).children("i.fa-caret-up").hide();
            node = null;
        }
    }

    function hide() {

        if (node != null) {
            $(node).removeClass("selected");
            node = null;
        }

        menu.classList.toggle("active");

        $(".my-dropdown").slideUp();
        $("i.fa-caret-up").hide();
    }

</script>